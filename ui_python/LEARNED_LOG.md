# LEARNED_LOG

## 目的
- 東京近辺の気温分布を細かく可視化するために、気象庁(JMA)の観測データを取得・整形する方法を試行。

---

## 試行の流れ

### 1. ダミーデータでの可視化
- 手作りの CSV を用意して、観測点を増やすほど補間結果が細かくなることを確認。
- まずは「観測点を増やすことが最優先」と理解。

### 2. JMA 公式ページからの CSV ダウンロード
- 「過去の気象データ」サイトから CSV をダウンロード。
- 文字コードが **Shift-JIS (cp932)** で、さらに 1,2,5,6 行目がメタ情報 → 読み取りで苦戦。
- 結果：
  - `encoding="cp932"` を指定。
  - `skiprows=[0,1,4,5]` などで不要行を読み飛ばす。
  - 3 行目 = 地点名, 4 行目 = 気象要素、を MultiIndex として DataFrame 化。
- 日ごとの平均気温を列=地点、行=日付の「ワイド表」で確認できた。

### 3. CSV の限界
- 列名が冗長、位置調整も必要で「一時凌ぎ」感が強い。
- ファイルそのものを扱うより **HTML 直接パース** が良さそうと結論。

### 4. HTML からのスクレイピング
- `pandas.read_html()` → `ValueError: No tables found` で失敗。
- BeautifulSoup で `<table id="tablefix1">` を直接指定。
- 行 (`<tr>`)、セル (`<td>`) を抽出し、数値を正規化して DataFrame へ。
- 正常に「時刻」「気温(℃)」を取得。

### 5. 拡張
- 追加で「降水量」「風速」も抽出可能に。
- 欠損は `--` → `0` or `NaN` で扱いを制御。
- 24時は翌日の 0:00 に補正。

---

## 得られた知見
- **気象庁 CSV**：形式が特殊すぎて、前処理コストが高い。
- **HTML パース**：対象テーブルを直接パースする方が圧倒的に楽。
- **地点切替**：URL の `block_no` と `prec_no` を変えるだけでよい。
- **時間分解能**：日・時間・10分単位のページがあり、用途に応じて使い分け可能。

---

## 今後の方針
- 候補点リスト（`prec_no`, `block_no` のセット）を準備。
- 複数地点・複数日をまとめて取得するスクリプトに拡張。
- 可視化や補間と組み合わせて、温度・降水・風速の分布を詳細に把握。

---

